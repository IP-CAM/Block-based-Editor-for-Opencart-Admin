'use strict';
/*!
 * Block Based Editor for OpenCart
 * https://chiaseek.com/
 * This project is developed and sponsored by CakeDeliver.com, a company dedicated to delivering high-quality baked goods and exceptional service.
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 *
 * Date: 2024-12-30T10:10
 */ 
const debounce=(e,t=300)=>{if("function"!=typeof e)throw new TypeError("Expected a function");let o;const n=function(...n){const l=this;clearTimeout(o),o=setTimeout((()=>{e.apply(l,n)}),t)};return n.cancel=()=>{clearTimeout(o),o=null},n},editors=document.querySelectorAll(".editor");for(let e=0;e<editors.length;e++){const t=editors[e].id;document.querySelector("#"+t+" .generate").addEventListener("click",(function(){this.textContent="Generating...",generate(t)})),document.querySelector("#"+t+" .addImg").addEventListener("click",(()=>addImageBlock(t,!1))),document.querySelector("#"+t+" .addVideo").addEventListener("click",(()=>addVideoBlock(t,!1))),document.querySelector("#"+t+" .addBlock").addEventListener("click",(()=>addBlock(t,!1))),document.querySelector("#"+t+" .addTable").addEventListener("click",(()=>addTable(t,!1)));let o=document.querySelector("#"+t);o.addEventListener("click",debounce((e=>{e.preventDefault();const n=e.target.getAttribute("data-block"),l=document.getElementById("TB"+n),a=e.target.closest(".tempblock");if(e.target.classList.contains("copyBlock")){generate(t,n),e.target.textContent="Copied",e.target.disabled=!0;const o=document.querySelectorAll(".generate");for(let e=0;e<o.length;e++){const t=o[e],n=t.getAttribute("data-editor");if(n){const e=document.createElement("button");e.type="button",e.classList.add("pasteBlock"),e.setAttribute("accesskey","g"),e.setAttribute("aria-label","Paste Block"),e.setAttribute("data-editor",n),e.textContent="Paste Block",t.insertAdjacentElement("afterend",e),e.addEventListener("click",(e=>{console.log("paste");let t=localStorage.getItem("copy");t&&processContent(n,"",restoreAngleBrackets(t))}))}}}if(e.target.classList.contains("removeBlock")){let e;if(a.nextElementSibling?e=a.nextElementSibling.querySelector(".block"):a.previousElementSibling&&(e=a.previousElementSibling.querySelector(".block")),a&&e){const t=e.querySelector("table");if(t){t.querySelector("td:first-child").focus()}else"SECTION"===e.tagName||["OL","UL"].includes(e.tagName)?e.firstElementChild.focus():e.focus();e.scrollIntoView({behavior:"instant",block:"nearest"})}l.previousElementSibling;if(""===document.getElementById(n).innerText.trim())l.remove();else{confirm("Are you sure you want to delete this block?")&&l.remove()}}const r=document.querySelector("#"+t+" .blocks");if(e.target.classList.contains("moveUp")&&a&&a.previousElementSibling&&(r.insertBefore(a,a.previousElementSibling),a.classList.add("highlight"),setTimeout((()=>{a.classList.remove("highlight")}),1e3),a.scrollIntoView({behavior:"smooth",block:"nearest"})),e.target.classList.contains("moveDown")&&a&&a.nextElementSibling&&(r.insertBefore(a.nextElementSibling,a),a.classList.add("highlight"),setTimeout((()=>{a.classList.remove("highlight")}),1e3),a.scrollIntoView({behavior:"smooth",block:"nearest"})),e.target.classList.contains("menuOnOff")){const t=document.querySelectorAll(".toolbar"),o=document.querySelectorAll(".menuOnOff");for(let e=0;e<o.length;e++){o[e].setAttribute("aria-expanded",!1)}e.target.setAttribute("aria-expanded",!0);for(let e=0;e<t.length;e++){t[e].classList.remove("active")}let l=document.querySelector("#MN"+n),a=document.querySelector("#TM"+n);l.classList.contains("active")?(l.classList.remove("active"),a.classList.remove("active")):(l.classList.add("active"),a.classList.add("active"))}o.addEventListener("click",(e=>closeMenu(e)));let c={h1:()=>convertToTag(t,n,"h1"),h2:()=>convertToTag(t,n,"h2"),h3:()=>convertToTag(t,n,"h3"),h4:()=>convertToTag(t,n,"h4"),h5:()=>convertToTag(t,n,"h5"),h6:()=>convertToTag(t,n,"h6"),div:()=>convertToTag(t,n,"div"),blockquote:()=>convertToTag(t,n,"blockquote"),preCode:()=>convertToTag(t,n,"pre"),p:()=>convertToTag(t,n,"p"),ol:()=>convertToTag(t,n,"ol"),ul:()=>convertToTag(t,n,"ul"),sectionol:()=>convertToTag(t,n,"sectionol"),sectionul:()=>convertToTag(t,n,"sectionul"),section:()=>convertToTag(t,n,"section"),editTag:()=>sectionOption(n,"tag"),addparagraph:()=>sectionOption(n,"addparagraph"),addBtnBlock:()=>addBlock(t,n),addImageBlock:()=>addImageBlock(t,n),imgAlt:()=>imageOption(n,"alt"),imgUpload:()=>imageUpload(n),imgURL:()=>imageOption(n,"link"),imgWidth:()=>imageOption(n,"width"),imgHeight:()=>imageOption(n,"height"),imgRemove:()=>imageOption(n,"removeCaption"),imgAdd:()=>imageOption(n,"addCaption"),imgCrossOrigin:()=>imageOption(n,"crossorigin"),embedURL:()=>embedOption(n,"link"),embedCrossOrigin:()=>embedOption(n,"crossorigin"),embedWidth:()=>embedOption(n,"width"),embedHeight:()=>embedOption(n,"height"),removeCaption:()=>tableOption(n,"removeCaption"),addCaption:()=>tableOption(n,"addCaption"),addRow:()=>tableOption(n,"addRow"),removeRow:()=>tableOption(n,"removeRow"),addCol:()=>tableOption(n,"addColumn"),removeCol:()=>tableOption(n,"removeColumn")};for(let[t,o]of Object.entries(c))if(e.target.classList.contains(t)){o();break}if(e.target.classList.contains("blocks")||e.target.classList.contains("tempblock")||e.target.classList.contains("editor")){const e=document.querySelectorAll(".toolbar");for(let t=0;t<e.length;t++)e[t].classList.remove("active");const t=document.querySelectorAll("[contenteditable]");for(let e=0;e<t.length;e++)t[e].setAttribute("contenteditable",!1);const o=document.querySelectorAll(".menuOnOff");for(let e=0;e<o.length;e++)o[e].setAttribute("aria-expanded",!1)}}),300)),o.addEventListener("focus",(e=>{if(e.target.matches("[contenteditable]")){let t=e.target.id||e.target.dataset.block,o=document.getElementById("TBAR"+t);const n=document.querySelectorAll(".toolbar");for(let e=0;e<n.length;e++)n[e].classList.remove("active");const l=document.querySelectorAll("[contenteditable]");for(let e=0;e<l.length;e++)l[e].setAttribute("contenteditable",!1),l[e].setAttribute("aria-current",!1),l[e].setAttribute("inputmode","text"),l[e].setAttribute("spellcheck",!1);e.target.setAttribute("contenteditable",!0),e.target.setAttribute("aria-current",!0),e.target.setAttribute("spellcheck",!0),o.classList.add("active"),setCarats(e.target)}}),!0);const n=()=>{document.fullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),a.textContent="Fullscreen"):(o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen(),a.textContent="Exit Fullscreen")},l=()=>{document.fullscreenElement?a.textContent="Exit Fullscreen":a.textContent="Fullscreen"},a=document.querySelector("#"+t+" .fullscreen");a.addEventListener("click",n),document.addEventListener("fullscreenchange",l),document.addEventListener("mozfullscreenchange",l),document.addEventListener("webkitfullscreenchange",l),document.addEventListener("msfullscreenchange",l);const r=document.querySelector("#"+t+" .preview"),c=e=>{e.close(),e.remove()};r.addEventListener("click",(()=>{generate(t);const e=previewDialog(t);document.body.appendChild(e),e.showModal();e.querySelector(".previewClose").addEventListener("click",(()=>c(e)))}));const i=e=>{let t=document.createElement("div");t.id="saveItem"+e,t.classList.add("saved-item");for(let o=0;o<localStorage.length;o++)if(localStorage.key(o)===e){let o=localStorage.getItem(e+"-date");t.textContent=o?"Found Saved: Draft "+o:"Found Saved: Draft ";let n=document.createElement("button");n.dataset.editor=e,n.type="button",n.textContent="Restored";let l=document.createElement("button");l.type="button",l.dataset.editor=e,l.textContent="Clear",l.addEventListener("click",(()=>{let e=l.dataset.editor;localStore.clear(e),localStore.clear(e+"-date"),document.getElementById("saveItem"+e).remove()})),n.addEventListener("click",(()=>{let e=n.dataset.editor,t=localStorage.getItem(e);if(t){const o=document.querySelector("#"+e+" .results");document.getElementById(o.id).value=restoreAngleBrackets(t),processContent(e,o.id),document.getElementById("saveItemeditor").textContent="Restored Done."}})),t.appendChild(n),t.appendChild(l),document.querySelector("#"+e+" .blocks").insertAdjacentElement("beforebegin",t)}};i(t),setInterval((function(){let e=localStorage.getItem(t),o=e?e.length:0,n=document.querySelector("#"+t+" .results").value;o!==(n?replaceAngleBrackets(n).length:0)&&generate(t)}),6e4)}const previewDialog=(e,t)=>{let o,n;if(t)n="previewdialog fmDialog",o=t;else{let t=document.querySelector("#"+e+" .results").value;n="previewdialog",o=t.length>10?t:"No Content"}const l=document.createElement("dialog");l.id="preview-"+Date.now()%1e4,l.className=n,l.setAttribute("aria-modal",!0);const a=document.createElement("div");a.className="previewbox",a.innerHTML=o;const r=document.createElement("button");return r.type="button",r.className="previewClose",r.innerText="Close",l.appendChild(r),l.appendChild(a),l},createLinkDialog=()=>{const e=document.createElement("dialog");e.id="dialog-"+Date.now()%1e4,e.className="linkdialog",e.setAttribute("aria-modal",!0);const t=document.createElement("div");t.className="dialogbox";const o=document.createElement("div");o.textContent="Edit Link",t.appendChild(o);[{label:"URL Text:",id:"linkText",mode:"text",className:"linkText",type:"text"},{label:"URL:",id:"url",mode:"url",className:"url",type:"text"},{label:"URL rel:",id:"rel",mode:"text",className:"rel",type:"text"},{label:"Block:",id:"block",mode:"text",className:"block",type:"hidden"},{label:"URL target:",id:"target",mode:"none",className:"target",type:"select",options:["_self","_blank","_parent","_top"]}].forEach((e=>{const o=document.createElement("div");o.className=" inputbox";const n=document.createElement("label");if(n.setAttribute("for",e.id),n.textContent=e.label,"hidden"!==e.type&&o.appendChild(n),"select"===e.type){const t=document.createElement("select");t.id=e.id,t.className=e.className+" linkTarget",e.options.forEach((e=>{const o=document.createElement("option");o.value=e,o.textContent=e,t.appendChild(o)})),o.appendChild(t)}else{const t=document.createElement("input");t.type=e.type,t.id=e.id,t.className=e.className,e.mode&&t.setAttribute("inputmode",e.mode),o.appendChild(t)}t.appendChild(o)}));const n=document.createElement("div");n.className="inputcontrol";return[{id:"updatelink",className:"updatelink",textContent:"Update"},{id:"removelink",className:"removelink",textContent:"Remove Link"},{id:"cancel",className:"cancel",textContent:"Close"}].forEach((e=>{const t=document.createElement("button");t.type="button",t.id=e.id,t.className=e.className,t.textContent=e.textContent,n.appendChild(t)})),t.appendChild(n),e.appendChild(t),e};document.body.appendChild(createLinkDialog());const keyboardSupport=(e,t)=>{document.addEventListener("keydown",(e=>{if("Escape"===e.key||27===e.keyCode){const{target:t}=e,o=t.dataset.block;(o||t.classList.contains("menuOnOff"))&&o&&(document.querySelector("#MN"+o).classList.remove("active"),document.querySelector("#TM"+o).classList.remove("active"))}})),e.addEventListener("keydown",(o=>{if("Enter"===o.key){const n=["SECTION","UL","OL"].includes(e.tagName)||["SECTION","UL","OL"].includes(o.target.tagName);if(o.preventDefault(),n)if(o.target.tagName.startsWith("H"))addBlock(t,e.id,"down"),e.blur();else{const e=o.target,t=e.cloneNode(!0);t.textContent="",e.insertAdjacentElement("afterend",t),t.focus()}else addBlock(t,e.id,"down"),e.blur()}if("Delete"===o.key||"Backspace"===o.key){if(["SECTION","UL","OL","TABLE","FIGURE"].includes(e.tagName)||["SECTION","UL","OL","FIGCAPTION","CAPTION","TD"].includes(o.target.tagName)){const e=o.target;if("TD"!==e.tagName&&"FIGCAPTION"!==e.tagName&&0===e.textContent.length){o.preventDefault();const t=e.previousSibling;t&&(e.remove(),t.focus())}}else if(o.target.textContent.length>1){const t=e.querySelector("br");document.execCommand("insertHTML",!1,""),t&&(o.preventDefault(),t.remove())}else{o.preventDefault();const t=document.querySelector("#TB"+e.id),n=t.previousSibling;t.remove(),n&&n.querySelector(".block").focus()}}})),e.addEventListener("paste",(e=>{e.preventDefault();const t=(e.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertHTML",!1,""),document.execCommand("insertText",!1,t.replace(/<br[^>]*>/g,"*").replace(/[\r\n]+/g,"**"))}))},closeMenu=e=>{e.preventDefault();const t=document.querySelectorAll(".menu"),o=document.querySelectorAll(".topMenu"),n=document.querySelectorAll(".menuOnOff");for(let l=0;l<t.length;l++){const a=t[l];a.classList.contains("active")&&(a.contains(e.target)||n[l].contains(e.target)||(a.classList.remove("active"),o[l].classList.remove("active")))}},addTable=(e,t)=>{const o=prompt("Enter Number Rows:",5),n=prompt("Enter Number Columns:",4),l=document.querySelector("#"+e+" .blocks"),a=document.createElement("div");a.id=Date.now()%1e6,a.className="block",o>0&&n>0?createTable(a,o,n):createTable(a,5,4);const r=createMenuList(a.id,a,"table");if(t>0){const e=document.getElementById("TB"+t);e&&e.insertAdjacentElement("beforebegin",r)}else l.appendChild(r);a.querySelector("caption").focus(),inlineTool(e,a.id)},createTable=(e,t,o)=>{const n=e;if(!n)return void console.error("Container not found");const l=document.createElement("table");l.id="table"+e.id;const a=document.createElement("caption");setDefaultAttribute(a,e.id,"Table Caption"),l.appendChild(a);for(let n=0;n<t;n++){const t=document.createElement("tr");for(let l=0;l<o;l++){const o=document.createElement("td");setDefaultAttribute(o,e.id),o.textContent=`Row ${n+1}, Col ${l+1}`,t.appendChild(o)}l.appendChild(t)}n.appendChild(l)},addImageBlock=(e,t)=>{const o=document.querySelector("#"+e+" .blocks"),n=document.createElement("figure");n.setAttribute("tabindex","0"),n.id=Date.now()%1e6,n.className="block";const l=document.createElement("picture");l.innerHTML='<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTuv7GqevqRqUgCNaskcs87rvMxqN-jENlxNQ&s" alt="" />',n.appendChild(l);const a=document.createElement("figcaption");setDefaultAttribute(a,n.id,"Image Description"),n.appendChild(a);const r=createMenuList(n.id,n,"image");if(t>0){const e=document.getElementById("TB"+t);e&&e.insertAdjacentElement("beforebegin",r)}else o.appendChild(r);a.focus(),inlineTool(e,n.id)},addVideoBlock=(e,t)=>{const o=document.querySelector("#"+e+" .blocks"),n=document.createElement("embed");n.setAttribute("tabindex","0"),n.id=Date.now()%1e6,n.className="block",n.width="315",n.height="560",n.src="https://www.youtube.com/embed/5ncnsuNm-6A?si=0FUJ5K2LWydm7oa";const l=createMenuList(n.id,n,"embed");if(t>0){const e=document.getElementById("TB"+t);e&&e.insertAdjacentElement("beforebegin",l)}else o.appendChild(l)},addBlock=(e,t,o)=>{const n=document.querySelector("#"+e+" .blocks"),l=document.createElement("p");l.id=Date.now()%1e6,l.className="block",setDefaultAttribute(l,l.id);const a=createMenuList(l.id,l,"general");if(t>0){const e=document.getElementById("TB"+t);e&&("down"===o?e.insertAdjacentElement("afterend",a):e.insertAdjacentElement("beforebegin",a))}else n.appendChild(a);l.focus(),inlineTool(e,l.id)},createMenuList=(e,t,o)=>{let n=document.createElement("div");n.dataset.block=t.id,n.id="TB"+e,n.className="tempblock";let l,a=document.createElement("button");if(a.type="button",a.className="menuOnOff",a.id="MB"+t.id,a.setAttribute("aria-haspopup",!0),a.setAttribute("aria-expanded",!1),a.setAttribute("aria-controls","MN"+e),a.dataset.block=t.id,"table"===o)l="TABLE";else if("section"===o&&t.querySelector("ol, ul")||"SECTION"===t.tagName&&t.querySelector("ol, ul")){const e=t.querySelector("ol, ul"),o=t.querySelector("h2, h3, h4, h5, h6");e&&(l=e.tagName.toUpperCase()+" "+o.tagName.toUpperCase())}else l=t.tagName;a.innerText=l,n.appendChild(a);let r=document.createElement("div");r.className="topMenu",r.id="TM"+t.id,r.role="menu",r.setAttribute("aria-label","block menu"),r.setAttribute("aria-controls",t.id);let c=document.createElement("button");c.type="button",c.className="removeBlock",c.dataset.block=t.id,c.textContent="X",c.setAttribute("aria-label","remove block id: "+t.id);let i=document.createElement("button");i.type="button",i.className="addBtnBlock",i.dataset.block=t.id,i.textContent="+Block";let s=document.createElement("button");s.type="button",s.className="addImageBlock",s.dataset.block=t.id,s.textContent="+Image";let d=document.createElement("button");d.type="button",d.className="moveUp",d.dataset.block=t.id,d.textContent="Up";let m=document.createElement("button");m.type="button",m.className="moveDown",m.dataset.block=t.id,m.textContent="Down",r.appendChild(c),r.appendChild(i),r.appendChild(s),r.appendChild(d),r.appendChild(m),n.appendChild(r);let u,b=document.createElement("ul");switch(b.className="menu",b.id="MN"+t.id,b.dataset.block=t.id,b.role="menu",b.setAttribute("aria-label","block menu"),b.setAttribute("aria-controls",t.id),b.setAttribute("aria-labelledby","MB"+t.id),o){case"section":u=[{className:"removeBlock",text:"Remove Block",title:"Remove Current Block"},{className:"copyBlock",text:"Copy Block",title:"Copy Block"},{className:"editTag",text:"Edit Title Tag",title:"Edit Title Tag"},{className:"addparagraph",text:"Add Paragraph",title:"Add Paragraph"},{className:"sectionul",text:"UL Block",title:"Convert to UL Block"},{className:"sectionol",text:"OL Block",title:"Convert to OL Block"},{className:"section",text:"Section Block",title:"Convert to Section Block"},{className:"ul",text:"Unordered List",title:"Convert to Unordered List"},{className:"ol",text:"Ordered List",title:"Convert to Ordered List"}];break;case"image":u=[{className:"removeBlock",text:"Remove Image",title:"Remove Image Block"},{className:"copyBlock",text:"Copy Block",title:"Copy Block"},{className:"imgUpload",text:"Upload Image",title:"Upload New Image"},{className:"imgURL",text:"Image URL",title:"Edit Image URL"},{className:"imgRemove",text:"Remove Caption",title:"Remove Caption"},{className:"imgAdd",text:"Add Caption",title:"Add Caption"},{className:"imgWidth",text:"Image Width",title:"Set Image Width"},{className:"imgHeight",text:"Image Height",title:"Set Image Height"},{className:"imgAlt",text:"Alt",title:"Edit Alt"},{className:"imgCrossOrigin",text:"CrossOrigin",title:"Edit CrossOrigin"}];break;case"embed":u=[{className:"removeBlock",text:"Remove Embed",title:"Remove Embed Block"},{className:"copyBlock",text:"Copy Block",title:"Copy Block"},{className:"embedURL",text:"Embed URL",title:"Edit Embed URL"},{className:"embedWidth",text:"Width",title:"Set Media Width"},{className:"embedHeight",text:"Height",title:"Set Media Height"},{className:"embedCrossOrigin",text:"CrossOrigin",title:"Edit CrossOrigin"}];break;case"table":u=[{className:"removeBlock",text:"Remove Table",title:"Remove Table Block"},{className:"copyBlock",text:"Copy Block",title:"Copy Block"},{className:"removeCaption",text:"Remove Caption",title:"Remove Table Caption"},{className:"addCaption",text:"Add Caption",title:"Add Table Caption"},{className:"addRow",text:"Add Row",title:"Add New Row"},{className:"removeRow",text:"Remove Row",title:"Remove Last Row"},{className:"addCol",text:"Add Column",title:"Add New Column"},{className:"removeCol",text:"Remove Column",title:"Remove Last Column"}];break;default:u=[{className:"removeBlock",text:"Remove",title:"Remove Block (CTRL-DELETE)"},{className:"copyBlock",text:"Copy Block",title:"Copy Block"},{className:"p",text:"Paragraph",title:"Convert to Paragraph (CTRL-7)"},{className:"div",text:"DIV",title:"Convert to DIV (CTRL-0)"},{className:"h1",text:"H1 Heading",title:"Convert to H1 (CTRL-1)"},{className:"h2",text:"H2 Heading",title:"Convert to H2 (CTRL-2)"},{className:"h3",text:"H3 Heading",title:"Convert to H3 (CTRL-3)"},{className:"h4",text:"H4 Heading",title:"Convert to H4 (CTRL-4)"},{className:"h5",text:"H5 Heading",title:"Convert to H5 (CTRL-5)"},{className:"h6",text:"H6 Heading",title:"Convert to H6 (CTRL-6)"},{className:"ul",text:"Unordered List",title:"Convert to Unordered List (CTRL-8)"},{className:"ol",text:"Ordered List",title:"Convert to Ordered List (CTRL-9)"},{className:"blockquote",text:"Blockquote",title:"Convert to Blockquote Block"},{className:"sectionul",text:"UL Block",title:"Convert to UL Block"},{className:"sectionol",text:"OL Block",title:"Convert to OL Block"},{className:"section",text:"Section Block",title:"Convert to Section Block"}]}for(let e=0;e<u.length;e++){const{className:o,text:n,title:l}=u[e];if("sectionul"===o){const e=document.createElement("hr");b.appendChild(e)}const a=document.createElement("button");let r;if(a.type="button",a.dataset.block=t.id,a.className=o,a.setAttribute("aria-label",l),a.textContent=n,"section"===t.tagName.toLowerCase()){const e=t.querySelector("ul, ol");if(t.querySelector("p")){r="section";const e=b.querySelector(".addparagraph");e&&e.remove()}e&&(r="section"+e.tagName.toLowerCase())}("section"!==t.tagName.toLowerCase()&&t.tagName.toLowerCase()===o||r===o)&&(a.disabled=!0,a.setAttribute("aria-disabled",!0)),b.appendChild(a)}return n.appendChild(t),n.appendChild(b),n.appendChild(inlineToolbar(t.id)),n},inlineToolbar=e=>{const t=document.createElement("div");t.className="toolbar",t.role="toolbar",t.setAttribute("aria-label","Text Formatting"),t.setAttribute("aria-controls",e),t.id="TBAR"+e,t.dataset.block=e;const o=[{className:"removeFormattingButton",format:"remove",text:"X",title:"Remove formatting (CTRL-X)"},{className:"boldButton",format:"strong",text:"B",title:"Bold Text (CTRL-B)"},{className:"italicButton",format:"em",text:"I",title:"Italic Text (CTRL-I)"},{className:"underlineButton",format:"u",text:"U",title:"Underline Text (CTRL-U)"},{className:"quoteButton",format:"q",text:'"',title:"Insert quotation marks (CTRL-Q)"},{className:"markButton",format:"mark",text:"Mark",title:"Marked text (CTRL-M)"},{className:"delButton",format:"del",text:"del",title:"Deleted Text (CTRL-D)"},{className:"codeButton",format:"code",text:"Code",title:"Inline Code (CTRL-O)"},{className:"abbr",format:"abbr",text:"a?",title:"Acronym (CTRL-E)"},{className:"kbd",format:"kbd",text:"kbd",title:"Keyboard Element (CTRL-K)"},{className:"insertLink",format:"addlink",text:"+Link",title:"Insert Link (CTRL-L)"}];for(let n=0;n<o.length;n++){const l=o[n],a=document.createElement("button");a.type="button",a.className=l.className+" format",a.ariaLabel=l.title,a.dataset.block=e,a.dataset.format=l.format,a.innerHTML=l.text,t.appendChild(a)}return t},removeAbbrIfMatches=e=>{document.querySelectorAll(".editor p abbr, .editor ul abbr, .editor ol abbr").forEach((t=>{if(t.textContent===e){const e=t.parentNode,o=document.createTextNode(t.textContent);e.replaceChild(o,t)}}))},insertAbbr=(e,t)=>{if(!Array.isArray(e))return void console.error("The first argument must be an array of words.");const o=new RegExp("\\b("+e.join("|")+")\\b(?![^<]*</abbr>)","gi");document.querySelectorAll(".editor p, .editor ul, .editor ol").forEach((function(e){e.innerHTML=e.innerHTML.replace(o,(function(e){return'<abbr title="'+t+'">'+e+"</abbr>"}))}))},getNode=(e,t)=>{const o=document.querySelectorAll(e);let n=null;return o.forEach((e=>{e.textContent.includes(t)&&(n=e)})),n},removeEmptyAttributes=()=>{document.querySelectorAll("*").forEach((e=>{Array.from(e.attributes).forEach((t=>{""===t.value&&e.removeAttribute(t.name)}))}))};function generate(e,t){const o=document.querySelector("#"+e+" .results"),n=document.querySelector("#"+e+" .generate");let l;o.value="",l=t?document.querySelectorAll("#"+e+" #TB"+t+" .block"):document.querySelectorAll("#"+e+" .blocks .block"),removeEmptyAttributes();let a=[];for(let e=0;e<l.length;e++){const t=l[e];t.innerHTML=t.innerHTML.replace(/<br>|<strong><\/strong>|<mark><\/mark>|<del><\/del>|<q><\/q>|<u><\/u>|<em><\/em>|<figcaption><\/figcaption>|<caption><\/caption>|<code><\/code>/g,"");const o=t.cloneNode(!0);o.removeAttribute("contenteditable"),o.removeAttribute("tabindex"),o.removeAttribute("id"),o.removeAttribute("class"),o.removeAttribute("role"),o.removeAttribute("inputmode"),o.removeAttribute("aria-current"),o.removeAttribute("data-placeholder"),o.removeAttribute("data-block"),o.removeAttribute("spellcheck");o.querySelectorAll("*").forEach((e=>{"BUTTON"===e.tagName&&e.hasAttribute("data-block")&&e.remove(),e.hasAttribute("id")&&e.removeAttribute("id"),e.hasAttribute("inputmode")&&e.removeAttribute("inputmode"),e.hasAttribute("spellcheck")&&e.removeAttribute("spellcheck"),e.hasAttribute("class")&&e.removeAttribute("class"),Array.from(e.attributes).forEach((t=>{(t.name.startsWith("aria-")||t.name.startsWith("data-")||"tabindex"===t.name||"inputmode"===t.name||"spellcheck"===t.name||"role"===t.name||"contenteditable"===t.name)&&e.removeAttribute(t.name)}))})),o.innerHTML=o.innerHTML.replace(/<br>|<strong><\/strong>|<mark><\/mark>|<del><\/del>|<q><\/q>|<u><\/u>|<em><\/em>|<span><\/span>|<figcaption><\/figcaption>|<caption><\/caption>|<code><\/code>/g,""),cleanUpNestedTags(o),o.innerHTML=o.innerHTML.replace(/<br[^>]*>/g,""),o.innerHTML=o.innerHTML.replace(/<li[^>]*>\s*<\/li>/g,""),o.innerHTML=o.innerHTML.replace(/id="table[^"]*"/g,""),"embed"===o.tagName.toLowerCase()&&console.log("embed"+o.innerHTML),("embed"===o.tagName.toLowerCase()||"figure"===o.tagName.toLowerCase()||""!==o.textContent.trim()&&""!==o.innerHTML.trim())&&a.push(o.outerHTML)}let r=a.join("\n");r=r.replace(/<br[^>]*>/g,"").replace(/\n/g,""),r=r.replace(/[\r\n]+/g,"");let c=sanitizeHtml(r);if(t)r.length>10&&localStore.save("copy",replaceAngleBrackets(c));else{o.value=c;const t=countWords(c);if(t>1){const n=document.getElementById("counter"+e);n&&n.remove();const l=document.createElement("p");l.id="counter"+e,l.textContent="Total Word: "+t,o.insertAdjacentElement("beforebegin",l)}r.length>10&&localStore.save(e,replaceAngleBrackets(c)),setTimeout((()=>{n.textContent="Generate"}),2e3)}}const cleanUpNestedTags=e=>{const t=["strong","em","b","i","br","span"];for(let o=0;o<t.length;o++){const n=t[o],l=e.getElementsByTagName(n);for(let e=l.length-1;e>=0;e--){const t=l[e];if(t.parentNode&&t.parentNode.tagName.toLowerCase()===n){for(;t.firstChild;)t.parentNode.insertBefore(t.firstChild,t);t.parentNode.removeChild(t)}}}},setCarats=e=>{"UL"!==e.tagName&&"OL"!==e.tagName&&e.getAttribute("contenteditable")&&(e.focus(),window.getSelection().selectAllChildren(e),window.getSelection().collapseToEnd())},convertToTag=(e,t,o)=>{const n=document.getElementById(t),l=(document.querySelector("#"+e+" .blocks"),n),a=n.tagName,r=n.innerText;let c,i;switch(o){case"section":i="SECTION",c=document.createElement("section"),c.id=t,c.className="block";const e=document.createElement("h2");if(setDefaultAttribute(e,n.id,"Write a Section Title"),"SECTION"===a){const t=n.querySelector("h2, h3, h4, h5, h6");e.innerText=t.textContent}c.appendChild(e);const l=n.querySelector("ol, ul");if("OL"===a||"UL"===a||"SECTION"===a&&l){const e=n.querySelectorAll("li");for(let o=0;o<e.length;o++){const n=e[o],l=document.createElement("p");setDefaultAttribute(l,t),l.innerHTML=n.innerHTML,c.appendChild(l)}}else{const e=document.createElement("p");setDefaultAttribute(e,t),e.innerText=r.replace(/<br[^>]*>/g,"").replace(/[\r\n]+/g,""),c.appendChild(e)}const s=createMenuList(t,c,"section");document.getElementById("TB"+t).replaceWith(s);break;case"sectionol":case"sectionul":let d=o.replace(/section/g,"");i=d.toUpperCase()+" H2",c=document.createElement("section"),c.id=t,c.className="block";const m=document.createElement("h2");if(setDefaultAttribute(m,t,"Write a Section Title"),"SECTION"===a){const e=n.querySelector("h2, h3, h4, h5, h6");m.innerText=e.textContent}else m.innerText=d.toUpperCase()+" Section Title";c.appendChild(m);const u=document.createElement(d);u.dataset.block=t;const b=n.querySelector("p"),p=n.querySelector("ol, ul");if("OL"===a||"UL"===a||"SECTION"===a&&p){const e=n.querySelectorAll("li");if(e)for(let o=0;o<e.length;o++){const n=e[o],l=document.createElement("li");setDefaultAttribute(l,t),l.innerHTML=n.innerHTML,u.appendChild(l)}}else if("SECTION"===a&&b){const e=n.querySelectorAll("p");for(let o=0;o<e.length;o++){const n=e[o],l=document.createElement("li");setDefaultAttribute(l,t),l.innerHTML=n.innerHTML,u.appendChild(l)}}else{const e=document.createElement("li");setDefaultAttribute(e,t),e.innerText=r,u.appendChild(e)}c.appendChild(u);const g=createMenuList(t,c,"section");document.getElementById("TB"+t).replaceWith(g),u.lastElementChild.focus();break;case"ol":case"ul":if(i=o.toUpperCase(),c=document.createElement(o),c.id=t,c.className="block","OL"===a||"UL"===a||"SECTION"===a){const e=n.querySelectorAll("li");for(let o=0;o<e.length;o++){const n=e[o],l=document.createElement("li");setDefaultAttribute(l,t),l.innerHTML=n.innerHTML,c.appendChild(l)}}else{const e=document.createElement("li");setDefaultAttribute(e,t),e.innerText=r,c.appendChild(e)}if("SECTION"===a){const e=createMenuList(t,c,"general");document.getElementById("TB"+t).replaceWith(e)}else n.replaceWith(c);c.lastElementChild.focus();break;case"pre":i="Code Block",c=document.createElement("pre"),c.id=t,setDefaultAttribute(c,t),c.className="block";const h=document.createElement("code");h.setAttribute("contenteditable",!0),h.id=t,h.innerText=r.replace(/<br[^>]*>/g,"").replace(/[\r\n]+/g,""),c.appendChild(h),n.replaceWith(c);break;default:i=o.toUpperCase(),c=document.createElement(o),c.id=t,setDefaultAttribute(c,t),c.className="block",c.innerText=r.replace(/<br[^>]*>/g,"").replace(/[\r\n]+/g,""),n.replaceWith(c)}inlineTool(e,t),"pre"===o?c.querySelector('contenteditable="true"').focus():c.focus();const s=l.querySelector("ol, ul"),d=l.querySelector("p");let m;if("SECTION"===a){if(s){const e="section"+l.querySelector("ol, ul").tagName;m=document.querySelector("#MN"+t+" ."+e.toLowerCase()),m.disabled=!1,m.setAttribute("aria-disabled",!1)}d&&(m=document.querySelector("#MN"+t+" .section"),m&&(m.disabled=!1,m.setAttribute("aria-disabled",!0)))}else m=document.querySelector("#MN"+t+" ."+o),m.disabled=!0,m.setAttribute("aria-disabled",!0);document.querySelector("#TB"+t+" .menuOnOff").innerText=i,document.querySelector("#MN"+t).classList.remove("active"),document.querySelector("#TM"+t).classList.remove("active")};async function readClipboard(){try{const e=await navigator.clipboard.readText();document.execCommand("insertText",!1,e)}catch(e){console.error("Failed to read clipboard contents: ",e)}}const inlineTool=(e,t)=>{const o=document.getElementById(e),n=document.getElementById(t),l=document.getElementById("TBAR"+t)||document.querySelector("#TB"+t+" .toolbar"),a=l.querySelectorAll(".format"),r=document.querySelector(".linkTarget"),c=[],i=[];let s,d=null;const m=()=>{c.push(n.innerHTML),i.length=0};n.addEventListener("input",debounce((e=>{if(!/Mobi|Android|iPad|iPhone/i.test(navigator.userAgent)){const t=e.target.innerHTML;t&&t.charAt(0)!==t.charAt(0).toUpperCase()&&(e.target.innerHTML=t.charAt(0).toUpperCase()+t.slice(1)),e.target.innerHTML=e.target.innerHTML.split(/(?<=[.?!])\s+/).map((e=>e.length>0?e.charAt(0).toUpperCase()+e.slice(1):e)).join(" "),setCarats(e.target)}m()}),300)),n.addEventListener("focus",(()=>{m()})),keyboardSupport(n,e),window.getSelection?s=window.getSelection():document.selection&&(s=document.selection.createRange()),document.addEventListener("selectionchange",debounce((()=>{s&&console.log("Selected: "+s.toString())}),500)),o.addEventListener("click",(e=>{const t=e.target.tagName;if(["A","KBD","ABBR","STRONG","Q","EM","U","CODE","MARK","DEL"].includes(t)){if(l.querySelectorAll(".disabled").forEach((e=>{e.classList.remove("disabled"),e.setAttribute("aria-disabled",!1)})),"A"!==t){const t=document.createRange();t.selectNodeContents(e.target),s.removeAllRanges(),s.addRange(t),l.querySelector('[data-format="'+e.target.tagName.toLowerCase()+'"]').classList.add("disabled"),l.querySelector('[data-format="'+e.target.tagName.toLowerCase()+'"]').setAttribute("aria-disabled",!0)}else e.target.hasAttribute("data-block")&&h(e)}else{l.querySelectorAll(".disabled").forEach((e=>{e.classList.remove("disabled")}))}})),a.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const t=e.target.dataset.format;if(t)switch(t){case"addlink":p();break;case"abbr":b();break;case"remove":g();break;default:u(t)}}))})),n.addEventListener("keydown",(t=>{if(console.log("Key: "+t.key),t.ctrlKey||t.metaKey){t.preventDefault();const o=document.querySelector("#"+e+" .blocks");let l=n.closest(".tempblock");switch(t.key){case"ArrowRight":if(l&&l.nextElementSibling){const e=l.nextElementSibling.querySelector(".block"),t=e.querySelector("table");if(t){t.querySelector("td:first-child").focus()}else"SECTION"===e.tagName||["OL","UL"].includes(e.tagName)?e.firstElementChild.focus():e.focus();e.scrollIntoView({behavior:"instant",block:"nearest"})}break;case"ArrowLeft":if(l&&l.previousElementSibling){const e=l.previousElementSibling.querySelector(".block"),t=e.querySelector("table");if(t){t.querySelector("td:first-child").focus()}else"SECTION"===e.tagName||["OL","UL"].includes(e.tagName)?e.firstElementChild.focus():e.focus();e.scrollIntoView({behavior:"instant",block:"nearest"})}break;case"ArrowDown":if(l&&l.nextElementSibling){o.insertBefore(l.nextElementSibling,l);const e=l.querySelector(".block"),t=e.querySelector("table");if(t){t.querySelector("td:last-child").focus()}else["SECTION","OL","UL"].includes(e.tagName)?e.lastElementChild.focus():e.focus();e.classList.add("highlight"),setTimeout((()=>e.classList.remove("highlight")),1e3),e.scrollIntoView({behavior:"instant",block:"nearest"})}break;case"ArrowUp":if(l&&l.previousElementSibling){o.insertBefore(l,l.previousElementSibling);const e=l.querySelector(".block"),t=e.querySelector("table");if(t){t.querySelector("td:last-child").focus()}else["SECTION","OL","UL"].includes(e.tagName)?e.lastElementChild.focus():e.focus();e.classList.add("highlight"),setTimeout((()=>e.classList.remove("highlight")),1e3),e.scrollIntoView({behavior:"instant",block:"nearest"})}break;case"Delete":const t=document.querySelector("#MN"+n.id+" button.removeBlock");if(t&&t.click(),l&&l.nextElementSibling){const e=l.nextElementSibling.querySelector(".block"),t=e.querySelector("table");if(t){t.querySelector("td:first-child").focus()}else"SECTION"===e.tagName||["OL","UL"].includes(e.tagName)?e.firstElementChild.focus():e.focus();e.scrollIntoView({behavior:"instant",block:"nearest"})}break;case"1":convertToTag(e,n.id,"h1");break;case"2":convertToTag(e,n.id,"h2");break;case"3":convertToTag(e,n.id,"h3");break;case"4":convertToTag(e,n.id,"h4");break;case"5":convertToTag(e,n.id,"h5");break;case"6":convertToTag(e,n.id,"h6");break;case"7":convertToTag(e,n.id,"p");break;case"8":convertToTag(e,n.id,"ol");break;case"9":convertToTag(e,n.id,"ul");break;case"0":convertToTag(e,n.id,"div");break;case"a":const a=document.createRange(),r=document.querySelector('[contenteditable="true"]');a.selectNodeContents(r),s.removeAllRanges(),s.addRange(a);break;case"b":u("strong");break;case"c":document.execCommand("copy");break;case"d":u("del");break;case"e":b();break;case"g":document.querySelector("#"+e+" .preview").click();break;case"i":u("em");break;case"j":document.querySelector("#TB"+n.id+" .menuOnOff").click();break;case"k":u("kbd");break;case"l":p();break;case"m":u("mark");break;case"o":u("code");break;case"q":u("q");break;case"u":u("u");break;case"v":readClipboard();break;case"x":g();break;case"y":i.length>0&&(c.push(n.innerHTML),n.innerHTML=i.pop());break;case"z":c.length>0&&(i.push(n.innerHTML),n.innerHTML=c.pop())}}else debounce((()=>{m()}),500);t.metaKey&&t.shiftKey&&"Z"===t.key&&(t.preventDefault(),document.execCommand("redo"))}));const u=e=>{if(s.rangeCount>0){const t=s.getRangeAt(0),o=t.extractContents(),n=o.textContent.trim();if(0===o.textContent.length)return void alert("Please select some text to apply the style.");let l=n;"kbd"===e&&(l=n.toUpperCase());const a=document.createTextNode(l),r=o.parentNode;if(r&&r.nodeName.toLowerCase()===e)r.textContent=n;else{const n=document.createElement(e);let l;o.textContent.endsWith(" ")&&(l=document.createTextNode(" "),t.insertNode(l)),n.appendChild(a),t.insertNode(n)}m()}},b=()=>{if(!s.rangeCount)return;const e=s.toString().trim();if(0===e.length)return;const t=s.getRangeAt(0);let o="";const n=getNode("abbr",e);n&&(o=n.title);const l=prompt("Acronym Title:",o||"");if(l){const o=t.extractContents(),n=document.createElement("abbr");let a;n.title=capitalizeWords(l),n.textContent=e,t.deleteContents(),o.textContent.endsWith(" ")&&(a=document.createTextNode(" "),t.insertNode(a)),t.insertNode(n),insertAbbr([e],capitalizeWords(l))}},p=()=>{if(!s.rangeCount)return;const e=s.toString().trim();if(0===e.length)return;let t="";const o=getNode("a",e);o&&(t=o.href);const l=prompt("Enter the link URL:",t||"https://");if(l){const t=s.getRangeAt(0),o=t.extractContents(),a=document.createElement("a");let r;a.href=l,a.target="_self",a.rel="noopener",a.dataset.block=n.id,a.textContent=e,t.deleteContents(),o.textContent.endsWith(" ")&&(r=document.createTextNode(" "),t.insertNode(r)),t.insertNode(a),a.addEventListener("click",h)}},g=()=>{if(!s.rangeCount)return;const e=s.getRangeAt(0),t=e.toString().trim();if(0===t.length)return;const o=(e.commonAncestorContainer.nodeType===Node.TEXT_NODE?e.commonAncestorContainer.parentNode:e.commonAncestorContainer).tagName;if("ABBR"===o){const e=s.toString();n=e,document.querySelectorAll(".editor p abbr, .editor ul abbr, .editor ol abbr").forEach((e=>{if(e.textContent===n){const t=e.parentNode,o=document.createTextNode(e.textContent);t.replaceChild(o,e)}}))}else if("KBD"===o||"DEL"===o||"STRONG"===o||"Q"===o||"EM"===o||"U"===o||"CODE"===o||"MARK"===o){const t=e.commonAncestorContainer.nodeType===Node.TEXT_NODE?e.commonAncestorContainer.parentNode:e.commonAncestorContainer,o=s.toString(),n=document.createTextNode(o);t.parentNode.replaceChild(n,t),s.removeAllRanges()}else{const o=s.toString(),n=document.createTextNode(t);if(e.deleteContents(),o.endsWith(" ")){const t=document.createTextNode(" ");e.insertNode(t)}e.insertNode(n),s.removeAllRanges();const l=document.createRange();l.selectNodeContents(n),l.collapse(!1),s.addRange(l)}var n},h=e=>{e.preventDefault(),d=e.target,document.getElementById("url").value=d.getAttribute("href"),document.getElementById("rel").value=d.rel,document.getElementById("target").value=d.target,document.getElementById("linkText").value=d.textContent,document.getElementById("block").value=d.dataset.block,document.querySelector(".linkdialog").showModal()};document.querySelector(".updatelink").addEventListener("click",(()=>{d&&d.dataset.block===document.getElementById("block").value&&(d.href=document.getElementById("url").value,d.rel=document.getElementById("rel").value,d.target=document.getElementById("target").value,d.textContent=document.getElementById("linkText").value,document.querySelector(".linkdialog").close())})),document.querySelector(".removelink").addEventListener("click",(()=>{if(d){const e=d.textContent;d.replaceWith(e),document.querySelector(".linkdialog").close()}})),document.querySelector(".cancel").addEventListener("click",(()=>{document.querySelector(".linkdialog").close()})),r.addEventListener("change",(e=>{e.preventDefault(),document.getElementById("updatelink").click()}))},capitalizeWords=e=>e.split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "),tableOption=(e,t)=>{const o=document.getElementById("table"+e),n=o.rows.length;switch(t){case"addRow":const l=o.insertRow(-1),a=o.rows[0].cells.length;for(let t=0;t<a;t++){const o=l.insertCell(t);setDefaultAttribute(o,e),o.innerHTML="New Row, Cell "+(t+1)}break;case"removeRow":n>1?o.deleteRow(n-1):alert("Cannot remove the header row.");break;case"addColumn":for(let t=0;t<n;t++){const n=o.rows[t].insertCell(-1);setDefaultAttribute(n,e),n.innerHTML="New Cell "+(t+1)}break;case"removeColumn":if(o.rows[0].cells.length>1)for(let e=0;e<n;e++)o.rows[e].deleteCell(-1);else alert("Cannot remove the last column.");break;case"removeCaption":const r=o.querySelector("caption");r&&o.removeChild(r);break;case"addCaption":const c=document.createElement("caption");setDefaultAttribute(c,e,"Table Caption"),o.appendChild(c);break;default:console.warn("Unknown option:",t)}},imageOption=(e,t)=>{const o=document.getElementById(e),n=o?.querySelector("img");if(!n)return void console.error(`Image element not found in block with ID: ${e}`);let l;switch(t){case"alt":l=prompt("Image Alt:",n.alt),l&&(n.alt=l);break;case"crossorigin":let a=n.getAttribute("crossorigin")||"";l=prompt('Image CrossOrigin: "user credentials" "anonymous"',a),l?n.setAttribute("crossorigin",l):n.removeAttribute("crossorigin");break;case"link":l=prompt("Image Link:",n.src),l&&(n.src=l);break;case"width":l=prompt("Image Width:",n.width),l&&(n.width=l);break;case"height":l=prompt("Image Height:",n.height),l&&(n.height=l);break;case"removeCaption":const r=o.querySelector("figcaption");r?o.removeChild(r):console.warn("No caption found to remove.");break;case"addCaption":const c=document.createElement("figcaption");setDefaultAttribute(c,e,"Image Description"),o.appendChild(c);break;default:console.error("Invalid option: "+t)}},embedOption=(e,t)=>{const o=document.getElementById(e);if(!o)return void console.error(`Element with ID ${e} not found.`);let n;switch(t){case"link":n=prompt("Embed Link:",o.src),n&&(o.src=n);break;case"crossorigin":let e=o.getAttribute("crossorigin")||"";n=prompt('Embed CrossOrigin: "user credentials" "anonymous"',e),n?o.setAttribute("crossorigin",n):o.removeAttribute("crossorigin");break;case"width":n=prompt("Embed Width: ",o.width),n&&(o.width=n);break;case"height":n=prompt("Embed Height: ",o.height),n&&(o.height=n);break;default:console.error("Invalid option: "+t)}},sectionOption=(e,t)=>{const o=document.getElementById(e);if(!o)return void console.error(`Element with ID ${e} not found.`);switch(t){case"tag":const n=o.querySelector("h2, h3, h4, h5, h6"),l=o.querySelector("ol, ul"),a=["H2","H3","H4","H5","H6"];let r=prompt("Change Title Tag To:",n.tagName);if(r&&a.includes(r.toUpperCase())){const t=document.createElement(r);Array.from(n.attributes).forEach((e=>{t.setAttribute(e.name,e.value)})),t.textContent=n.textContent,n.parentNode.replaceChild(t,n),document.querySelector("#TB"+e+" .menuOnOff").innerText=l.tagName.toUpperCase()+" "+r.toUpperCase(),document.querySelector("#MN"+e).classList.remove("active"),t.focus()}else alert("Invalid tag name. Please enter one of the following: H2, H3, H4, H5, H6.");break;case"addparagraph":const c=o.querySelector("ol, ul");if(c){const t=document.createElement("p");setDefaultAttribute(t,e),c.parentNode.insertBefore(t,c),t.focus()}else console.log("No list found to add a paragraph before.");break;default:console.error("Invalid option: "+t)}};function imageUpload(e){const t=document.getElementById("form-upload");t&&t.remove();const o=document.createElement("form");o.enctype="multipart/form-data",o.id="form-upload",o.style.display="none";const n=document.createElement("input");let l;n.type="file",n.name="file[]",n.multiple=!0,o.appendChild(n),document.body.prepend(o),n.click(),void 0!==l&&clearInterval(l),l=setInterval((function(){if(""!==n.value){clearInterval(l);const t=new FormData(o);fetch("index.php?route=common/filemanager/upload&token=<?php echo $token; ?>&directory="+"",{method:"POST",body:t}).then((e=>e.json())).then((t=>{if(console.log("Upload: "+t.file.url),t.error&&alert(t.error),t.success){document.getElementById(e).querySelector("img").src=t.file.url}})).catch((e=>{alert(e)})).finally((()=>{}))}}),500)}function processContent(e,t,o){const n=o||document.getElementById(t).value.replace(/[\r\n]+/g," ").replace(/\s{2,}/g," ").replace(/>\s+</g,"><").replace(/<span[^>]*>(.*?)<\/span>/gi,"$1"),l=(new DOMParser).parseFromString(n,"text/html"),a=l.querySelectorAll("a");l.querySelectorAll("span").forEach((e=>e.remove()));l.querySelectorAll("br").forEach((e=>e.remove()));const r=document.querySelector("#"+e+" .blocks");o||(r.innerHTML="");let c=Date.now()%1e4;if(a.length>0)for(let e=0;e<a.length;e++)a[e].dataset.block=c;const i=l.body.childNodes;for(let t=0;t<i.length;t++){const o=i[t];if(o.nodeType===Node.ELEMENT_NODE){const t=o.tagName.toLowerCase();let n;if("section"===t){const e=o.querySelector("h2, h3, h4, h5, h6"),t=o.querySelector("ul, ol"),l=o.querySelector("p");n=document.createElement("section"),n.className="block",n.id=c;const a=document.createElement(e.tagName);let r,i;if(setDefaultAttribute(a,c,"Write a "+e.tagName+" Section Title"),a.innerText=e.textContent,n.appendChild(a),t){r=t.tagName,i="li";const e=o.querySelectorAll("p");if(e)for(let t=0;t<e.length;t++){const o=e[t],l=document.createElement("p");setDefaultAttribute(l,c),l.innerHTML=o.innerHTML,n.appendChild(l)}const l=document.createElement(r);l.dataset.block=c;const a=o.querySelectorAll(i);for(let e=0;e<a.length;e++){const t=a[e],o=document.createElement(i);setDefaultAttribute(o,c),o.innerHTML=t.innerHTML,l.appendChild(o)}n.appendChild(l)}if(l&&!t){r=l.tagName,i="p";const e=o.querySelectorAll(i);for(let t=0;t<e.length;t++){const o=e[t],l=document.createElement(i);setDefaultAttribute(l,c),l.innerHTML=o.innerHTML,n.appendChild(l)}}}else if("ul"===t||"ol"===t){n=document.createElement(t),n.className="block",n.id=c;const e=o.querySelectorAll("li");for(let t=0;t<e.length;t++){const o=e[t],l=document.createElement("li");setDefaultAttribute(l,c),l.innerHTML=o.innerHTML,n.appendChild(l)}}else if("img"===t){n=document.createElement("figure"),n.setAttribute("tabindex","0"),n.id=c,n.className="block";const e=document.createElement("picture"),t=document.createElement("img");t.src=o.src;const l=document.createElement("figcaption");setDefaultAttribute(l,c,"Image Description"),e.appendChild(t),n.appendChild(e),n.appendChild(l)}else{const e=(new DOMParser).parseFromString(o.innerHTML,"text/html"),l=e.querySelector("table"),a=e.querySelectorAll("caption"),r=e.querySelectorAll("td"),i=e.querySelectorAll("figcaption");if(r.length>0)for(let e=0;e<r.length;e++)setDefaultAttribute(r[e],c),r[e].dataset.block=c;if(a.length>0)for(let e=0;e<a.length;e++)setDefaultAttribute(a[e],c,"Table Caption"),a[e].dataset.block=c;if(l&&(l.id="table"+c),i.length>0)for(let e=0;e<i.length;e++)setDefaultAttribute(i[e],c,"Image Description"),i[e].dataset.block=c;o.innerHTML=e.body.innerHTML,n=document.createElement(t),n.innerHTML=o.innerHTML,setDefaultAttribute(n,c),n.id=c,n.className="block","embed"===t&&(n.src=o.src,n.width=o.width,n.height=o.height,n.removeAttribute("contenteditable")),(o.innerHTML.includes("<table")||/<table\b[^>]*>/i.test(o.innerHTML))&&n.removeAttribute("contenteditable"),"figure"===t&&n.removeAttribute("contenteditable")}if("section"===t){const e=createMenuList(c,n,"section");r.appendChild(e)}else if("figure"===t||"img"===t){const e=createMenuList(c,n,"image");r.appendChild(e)}else if("embed"===t){const e=createMenuList(c,n,"embed");r.appendChild(e)}else if(o.innerHTML.includes("<table")||/<table\b[^>]*>/i.test(o.innerHTML)){const e=createMenuList(c,n,"table");r.appendChild(e)}else{const e=createMenuList(c,n,"general");r.appendChild(e)}inlineTool(e,c);const l=document.querySelectorAll("[contenteditable]");for(let e=0;e<l.length;e++)l[e].setAttribute("contenteditable",!1);c++}}}function sanitizeHtml(e){const t=document.createElement("div");t.innerHTML=e;const o=["section","code","kbd","abbr","b","i","em","strong","q","mark","del","a","p","u","ul","ol","li","h1","h2","h3","h4","h5","h6","img","table","caption","figcaption","figure","picture","tr","td","embed"];return function e(t){if(t.nodeType===Node.ELEMENT_NODE){if(!o.includes(t.tagName.toLowerCase()))return void t.remove();const n=[];for(let e of Array.from(t.attributes))"href"!==e.name&&"target"!==e.name&&n.push(e.name);for(let e of n)t.removeAttribute(e);for(let o of Array.from(t.childNodes))e(o)}}(t),t.innerHTML}document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".results");for(let t=0;t<e.length;t++){const o=e[t],n=o.getAttribute("data-editor");""!==o.value.trim()?processContent(n,o.id):addBlock(n,!1)}}));const replaceAngleBrackets=e=>e.replace(/</g,"/**").replace(/>/g,"**/"),restoreAngleBrackets=e=>e.replace(/\/\*\*/g,"<").replace(/\*\*\//g,">"),localStore={save:(e,t)=>{const o=new Date;localStorage.setItem(e,t),localStorage.setItem(e+"-date",o.toISOString())},load:(e,t)=>{const o=localStorage.getItem(e);o&&(document.getElementById("results"+e).innerHTML=o)},clear:e=>{localStorage.removeItem(e)}},setDefaultAttribute=(e,t,o)=>e&&"function"==typeof e.setAttribute?(e.setAttribute("contenteditable",!0),e.setAttribute("tabindex","0"),e.setAttribute("role","textbox"),e.setAttribute("data-placeholder",o||"Type something..."),e.dataset.block=t,e):(console.error("Invalid element passed to setDefaultAttribute:",e),null),countWords=e=>{const t=document.createElement("div");t.innerHTML=e;return(t.innerText??t.textContent).trim().split(/\s+/).length};
